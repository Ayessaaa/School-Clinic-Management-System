<!-- npx tailwindcss -i ./src/input.css -o ./build/css/style.css --watch   -->
<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>MediSYNC</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link rel="stylesheet" href="css/style.css" />
    <link rel="preconnect" href="https://fonts.googleapis.com" />
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin />
    <link
      href="https://fonts.googleapis.com/css2?family=DM+Sans:ital,opsz,wght@0,9..40,100..1000;1,9..40,100..1000&display=swap"
      rel="stylesheet"
    />
    <style>
      body {
        font-family: "DM Sans";
      }
    </style>
  </head>
  <body>
    <div
      class="p-8 shadow-md bg-gray-50 drop-shadow-sm h-screen absolute invisible 2xl:visible w-1/6 rounded-r-2xl"
    >
      <p class="font-extrabold text-3xl">MediSYNC</p>

      <div class="grid grid-cols-1">
        <div
          class="flex items-center mx-2 mt-3 px-4 mb-1 bg-white rounded-xl shadow-sm border hover:bg-red-100 hover:border-red-200 border-gray-200"
        >
          <svg
            xmlns="http://www.w3.org/2000/svg"
            fill="none"
            viewBox="0 0 24 24"
            stroke-width="1.5"
            stroke="currentColor"
            class="size-6 inline stroke-red-400 stroke-2"
          >
            <path
              stroke-linecap="round"
              stroke-linejoin="round"
              d="m2.25 12 8.954-8.955c.44-.439 1.152-.439 1.591 0L21.75 12M4.5 9.75v10.125c0 .621.504 1.125 1.125 1.125H9.75v-4.875c0-.621.504-1.125 1.125-1.125h2.25c.621 0 1.125.504 1.125 1.125V21h4.125c.621 0 1.125-.504 1.125-1.125V9.75M8.25 21h8.25"
            />
          </svg>
          <span class="mx-3 my-2 font-semibold text-lg">Home</span>
        </div>

        <div
          onclick="window.location.href = 'students';"
          class="group flex items-center mx-2 px-4 border-gray-200 hover:stroke-red-500 cursor-pointer"
        >
          <svg
            xmlns="http://www.w3.org/2000/svg"
            fill="none"
            viewBox="0 0 24 24"
            stroke-width="1.5"
            stroke="currentColor"
            class="size-6 inline stroke-gray-500 group-hover:stroke-red-500"
          >
            <path
              stroke-linecap="round"
              stroke-linejoin="round"
              d="M15 19.128a9.38 9.38 0 0 0 2.625.372 9.337 9.337 0 0 0 4.121-.952 4.125 4.125 0 0 0-7.533-2.493M15 19.128v-.003c0-1.113-.285-2.16-.786-3.07M15 19.128v.106A12.318 12.318 0 0 1 8.624 21c-2.331 0-4.512-.645-6.374-1.766l-.001-.109a6.375 6.375 0 0 1 11.964-3.07M12 6.375a3.375 3.375 0 1 1-6.75 0 3.375 3.375 0 0 1 6.75 0Zm8.25 2.25a2.625 2.625 0 1 1-5.25 0 2.625 2.625 0 0 1 5.25 0Z"
            />
          </svg>

          <span
            class="m-2 font-medium text-md text-gray-700 group-hover:text-black"
            >Students</span
          >
        </div>

        <div
          onclick="window.location.href = 'clinic-history';"
          class="group flex items-center mx-2 px-4 cursor-pointer"
        >
          <svg
            xmlns="http://www.w3.org/2000/svg"
            fill="none"
            viewBox="0 0 24 24"
            stroke-width="1.5"
            stroke="currentColor"
            class="size-6 inline stroke-gray-500 group-hover:stroke-red-500"
          >
            <path
              stroke-linecap="round"
              stroke-linejoin="round"
              d="M12 6v6h4.5m4.5 0a9 9 0 1 1-18 0 9 9 0 0 1 18 0Z"
            />
          </svg>

          <span
            class="m-2 font-medium text-md text-gray-700 group-hover:text-black"
            >History</span
          >
        </div>

        <div
          onclick="window.location.href = 'form.html';"
          class="group flex items-center mx-2 px-4 cursor-pointer"
        >
          <svg
            xmlns="http://www.w3.org/2000/svg"
            fill="none"
            viewBox="0 0 24 24"
            stroke-width="1.5"
            stroke="currentColor"
            class="size-6 inline stroke-gray-500 group-hover:stroke-red-500"
          >
            <path
              stroke-linecap="round"
              stroke-linejoin="round"
              d="M12 7.5h1.5m-1.5 3h1.5m-7.5 3h7.5m-7.5 3h7.5m3-9h3.375c.621 0 1.125.504 1.125 1.125V18a2.25 2.25 0 0 1-2.25 2.25M16.5 7.5V18a2.25 2.25 0 0 0 2.25 2.25M16.5 7.5V4.875c0-.621-.504-1.125-1.125-1.125H4.125C3.504 3.75 3 4.254 3 4.875V18a2.25 2.25 0 0 0 2.25 2.25h13.5M6 7.5h3v3H6v-3Z"
            />
          </svg>

          <span
            class="m-2 font-medium text-md text-gray-700 group-hover:text-black"
            >Form</span
          >
        </div>
      </div>
    </div>

    <div class="grid grid-cols-2 gap-4 mx-auto p-5 max-w-screen-lg pt-10">
      <div class="col-span-2 mx-auto">
        <input
          class="w-72 px-4 bg-white rounded-xl shadow-sm border mb-6 hover:bg-red-50 hover:border-red-100 border-gray-200 p-2 text-sm focus:bg-red-100 focus:outline-none focus:ring-1 focus:ring-red-300"
          placeholder="Search"
          type=""
          text
        />
        <button
          class="bg-red-300 p-2 border ml-3 font-semibold border-red-400 shadow-sm rounded-lg text-white text-sm px-4"
        >
          Search
        </button>
      </div>
      <div
        id="scan_button"
        class="cursor-pointer h-48 col-span-2 sm:col-span-1 bg-red-50 place-content-center border-dashed hover:bg-red-100 hover:border-red-400 border-red-300 rounded-xl text-center shadow-sm border-2"
      >
        <span class="tracking-wide text-2xl font-extrabold" id="scan_text">SCAN ID</span><br />
        <span class="text-sm text-gray-500">Tap your ID in the scanner</span>
      </div>

      <% const date = new Date(); %> <% const months = ["January", "February",
      "March", "April", "May", "June", "July", "August", "September","October",
      "November", "December"] %> <% var today_counter = 0; %> <%
      visits.forEach(visit => { %> <% if (visit.date.getMonth() ===
      date.getMonth() && visit.date.getDate() === date.getDate() &&
      visit.date.getFullYear() === date.getFullYear()){ %> <% today_counter += 1
      %> <% } }); %> <% var month_counter = 0; %> <% visits.forEach(visit => {
      %> <% if (visit.date.getMonth() === date.getMonth() &&
      visit.date.getFullYear() === date.getFullYear()){ %> <% month_counter += 1
      %> <% } }); %>

      <div class="col-span-2 sm:col-span-1 p-6 rounded-xl shadow-sm border">
        <h1 class="font-extrabold text-xl">Visits</h1>
        <p class="text-sm text-gray-500">Total Clinic Visits</p>
        <div class="grid grid-cols-3 place-items-center m-3">
          <div>
            <p class="text-center font-semibold text-3xl">
              <%= today_counter %>
            </p>
            <p class="text-md text-center text-gray-600">Today</p>
          </div>
          <div>
            <p class="text-center font-semibold text-3xl">
              <%= month_counter%>
            </p>
            <p class="text-md text-center text-gray-600">This Month</p>
          </div>
          <div>
            <p class="text-center font-semibold text-3xl">
              <%= visits.length %>
            </p>
            <p class="text-md text-center text-gray-600">All Visits</p>
          </div>
        </div>
      </div>

      <div class="col-span-2 mt-5">
        <div class="flex items-center m-4">
          <svg
            xmlns="http://www.w3.org/2000/svg"
            fill="none"
            viewBox="0 0 24 24"
            stroke-width="1.5"
            stroke="currentColor"
            class="size-6 mr-2 stroke-red-400 stroke-2"
          >
            <path
              stroke-linecap="round"
              stroke-linejoin="round"
              d="M12 6v6h4.5m4.5 0a9 9 0 1 1-18 0 9 9 0 0 1 18 0Z"
            />
          </svg>
          <span class="font-bold text-xl cursor-pointer" onclick="window.location.href='/clinic-history'">Clinic Visit History</span>
        </div>

        <div
          class="rounded-lg overflow-y-auto h-96 max-h-[400px] [&::-webkit-scrollbar]:w-2 [&::-webkit-scrollbar-track]:rounded-full [&::-webkit-scrollbar-track]:bg-gray-100 [&::-webkit-scrollbar-thumb]:rounded-full [&::-webkit-scrollbar-thumb]:bg-gray-300"
        >
          <p></p>
          <table class="border-collapse w-full">
            <thead
              class="bg-gray-50 drop-shadow-sm shadow-inner text-left sticky top-0"
            >
              <tr class="*:font-normal *:text-sm *:text-gray-500">
                <th class="px-5 py-2 font-normal text-sm w-3/12">Patient</th>
                <th class="w-2/12">Section</th>
                <th class="w-4/12">Reason</th>
                <th class="w-1/12">Time</th>
                <th class="w-2/12">Date</th>
              </tr>
            </thead>
            <tbody class="cursor-pointer">
              <% if (visits.length > 0){ %> <% visits.forEach(visit => { %>
              <tr
                class="border-b hover:bg-gray-50"
                onclick="window.location.href = '/clinic-history/details/<%= visit._id %>';"
              >
                <td class="px-5 py-2 font-semibold"><%= visit.name %></td>
                <td class="text-gray-600"><%= visit.section %></td>
                <td class=""><%= visit.reason %></td>

                <% 
                  var hour = parseInt(visit.time_start.split(':')[0]); 
                  var minute = visit.time_start.split(':')[1];
                  var am_pm = '';

                  if (hour < 12) { 
                    if (hour === 0) { 
                      hour = 12;  // Midnight case
                    }
                    am_pm = 'AM'; 
                  } else { 
                    if (hour === 12) {
                      hour = 12;  // Noon case
                    } else {
                      hour -= 12; // Convert PM time
                    }
                    am_pm = 'PM'; 
                  }
                %>
                <td class="text-gray-500">
                  <%= hour + ":" + minute + " " + am_pm %>
                </td>
                <td class="text-gray-500">
                  <%= visit.date.toLocaleString('en-us',{month:'short', day:
                  'numeric', year:'numeric'}) %>
                </td>
              </tr>
              <% }) %> <% } %>
            </tbody>
          </table>
        </div>
      </div>

      <input
      autocomplete="off"
        type="number"
        name="rfid"
        id="rfid_input"
        class="text-white focus:outline-none cursor-default [appearance:textfield] [&::-webkit-outer-spin-button]:appearance-none [&::-webkit-inner-spin-button]:appearance-none"
      />
    </div>

    <script type="text/javascript" src="../../js/index.js"></script>
  </body>
</html>
